var Emory=function(t){t||(t={}),this._initInterval="number"==typeof t.initInterval?t.initInterval:this.constructor.__initInterval,this._attributePrefix="string"==typeof t.attributePrefix?t.attributePrefix:this.constructor.__attributePrefix,this._checkResponseSuccess="function"==typeof t.checkResponseSuccess?t.checkResponseSuccess:this.constructor.__checkResponseSuccess,this._getResponseErrorString="function"==typeof t.getResponseErrorString?t.getResponseErrorString:this.constructor.__getResponseErrorString,this._getResponseMessageString="function"==typeof t.getResponseMessageString?t.getResponseMessageString:this.constructor.__getResponseMessageString,this._getResponseViewHtml="function"==typeof t.getResponseViewHtml?t.getResponseViewHtml:this.constructor.__getResponseViewHtml,this._generateAlertHtml="function"==typeof t.generateAlertHtml?t.generateAlertHtml:this.constructor.__generateAlertHtml,this._getResponseCallbackUrl="function"==typeof t.getResponseCallbackUrl?t.getResponseCallbackUrl:this.constructor.__getResponseCallbackUrl,this._init()};Emory.__attributePrefix="emory-",Emory.__initInterval=5e3,Emory.__checkResponseSuccess=function(t){return"undefined"==typeof t||"undefined"==typeof t.success||t.success!==!0&&1!==t.success&&"1"!==t.success?!1:!0},Emory.__getResponseErrorString=function(t){return"undefined"!=typeof t&&"undefined"!=typeof t.error?t.error:""},Emory.__getResponseMessageString=function(t){return"undefined"!=typeof t&&"undefined"!=typeof t.message?t.message:""},Emory.__getResponseViewHtml=function(t,e){return"undefined"!=typeof t&&"undefined"!=typeof t.data&&"undefined"!=typeof t.data.views&&"undefined"!=typeof t.data.views[e]?t.data.views[e]:""},Emory.__generateAlertHtml=function(t,e){var r=this,a="";return a+="<div "+r._attributePrefix+'alert="" data-alert="" class="alert-box '+e+'">',a+=t,a+='<a href="#" class="close">Ã—</a>',a+="</div>"},Emory.__getResponseCallbackUrl=function(t){return"undefined"!=typeof t&&"undefined"!=typeof t.callback_url&&t.callback_url.length>0?t.callback_url:""},Emory.prototype.__matchPattern=function(t,e,r){var a=this;return 0===t.indexOf(a._attributePrefix+e)&&t.substr(t.length-r.length)===r?!0:!1},Emory.prototype.__replacePostfix=function(t,e,r){return t.substr(0,t.length-e.length)+r},Emory.prototype.__getKey=function(t,e,r){var a=this;return prefixedPre=a._attributePrefix+e,t.substr(prefixedPre.length,t.length-prefixedPre.length-r.length)},Emory.prototype._init=function(){var t=this;$(document).on("click","["+t._attributePrefix+"click-submit]",function(e){e.preventDefault(),t._handleFormSubmit($(this))}),$(document).on("change","["+t._attributePrefix+"change-submit]",function(e){e.preventDefault(),t._handleFormSubmit($(this))}),$(document).on("keydown","["+t._attributePrefix+"enter-submit]",function(e){var r=e.keyCode||e.which;return 13==r?(t._handleFormSubmit($(this)),!1):void 0}),$(document).on("valid.fndtn.abide","["+t._attributePrefix+"abide-submit]",function(){t._handleFormSubmit($(this))}),$(document).on(t._attributePrefix+"submit","["+t._attributePrefix+"ajax]",function(){t._handleFormSubmit($(this))}),$(document).on(t._attributePrefix+"submit","["+t._attributePrefix+"normal]",function(){t._handleFormSubmit($(this))}),t._checkOnloadForms(),t._checkTimeoutForms(),setInterval(function(){t._checkOnloadForms(),t._checkTimeoutForms()},t._initInterval)},Emory.prototype._checkOnloadForms=function(){var t=this,e=$("["+t._attributePrefix+"onload-submit]");e.each(function(e,r){$(r).removeAttr(t._attributePrefix+"onload-submit"),t._handleFormSubmit($(r))})},Emory.prototype._checkTimeoutForms=function(){var t=this,e=$("["+t._attributePrefix+"timeout-submit]");e.each(function(e,r){var a=$(r).attr(t._attributePrefix+"timeout-submit");if($(r).removeAttr(t._attributePrefix+"timeout-submit"),0!==a.length){var i=""+Math.floor(999999999*Math.random())+Date.now();$(r).attr(t._attributePrefix+"pending-timeout-submit",i),setTimeout(function(){t._submitTimeoutForm(i)},parseFloat(a))}})},Emory.prototype._submitTimeoutForm=function(t){var e=this,r=$("["+e._attributePrefix+'pending-timeout-submit="'+t+'"]');return 0!==r.length?(r.removeAttr(e._attributePrefix+"pending-timeout-submit"),e._handleFormSubmit(r)):void 0},Emory.prototype._handleFormSubmit=function(t){var e=this;return $form=t.closest("form"),"form"===t.prop("tagName").toLowerCase()&&($form=t),$form.attr(e._attributePrefix+"loading-target")&&$($form.attr(e._attributePrefix+"loading-target")).addClass(e._attributePrefix+"loading"),$.each(t.get(0).attributes,function(r,a){var i=a.name,o=a.value;if(e.__matchPattern(i,"submit-input-","-name")){var n=e.__replacePostfix(i,"-name","-value");"undefined"!=typeof t.attr(n)&&$form.find('input[name="'+o+'"]').val(t.attr(n))}}),"undefined"!=typeof t.attr(e._attributePrefix+"submit-action")&&$form.attr("action",t.attr(e._attributePrefix+"submit-action")),"undefined"!=typeof t.attr(e._attributePrefix+"submit-ajax")?e._submitFormAjax($form):"undefined"!=typeof t.attr(e._attributePrefix+"submit-normal")?e._submitFormNormal($form):"undefined"!=typeof $form.attr(e._attributePrefix+"ajax")?e._submitFormAjax($form):"undefined"!=typeof $form.attr(e._attributePrefix+"normal")?e._submitFormNormal($form):void 0},Emory.prototype._submitFormNormal=function(t){t.submit()},Emory.prototype._submitFormAjax=function(t){var e=this;if("undefined"!=typeof t.attr(e._attributePrefix+"alert-target")&&e._removeAllAlerts(t,$(t.attr(e._attributePrefix+"alert-target"))),t.find('input[type="file"]').length)return"FormData"in window?e._submitFormAjaxFile(t):e._submitFormAjaxFileFallback(t);var r={};t.find('input:not([type="checkbox"]):not([type="radio"]), select, textarea').each(function(){r[$(this).attr("name")]=$(this).val()});var a={};t.find('input[type="checkbox"], input[type="radio"]').each(function(){$(this).is(":checked")&&(a[$(this).attr("name")]=a[$(this).attr("name")]?a[$(this).attr("name")]+","+$(this).val():$(this).val())});for(checkboxName in a)r[checkboxName]=a[checkboxName];$.ajax({url:t.attr("action"),type:"POST",data:$.param(r),dataType:"json",success:function(r){return e._handleFormAjaxComplete(t,r)},error:function(r,a){return e._handleFormAjaxFailure(t,a)}})},Emory.prototype._submitFormAjaxFile=function(t){var e=this,r=new FormData;r.append("MAX_FILE_SIZE","2000000000"),t.find('input:not([type="checkbox"]):not([type="radio"]):not([type="file"]), select, textarea').each(function(){r.append($(this).attr("name"),$(this).val())});var a={};t.find('input[type="checkbox"], input[type="radio"]').each(function(){$(this).is(":checked")&&(a[$(this).attr("name")]=a[$(this).attr("name")]?a[$(this).attr("name")]+","+$(this).val():$(this).val())});for(checkboxName in a)r.append(checkboxName,a[checkboxName]);t.find('input[type="file"]').each(function(){var t=$(this).get(0);r.append($(this).attr("name"),t.files[0])}),$.ajax({url:t.attr("action"),type:"POST",data:r,processData:!1,contentType:!1,dataType:"json",success:function(r){return e._handleFormAjaxComplete(t,r)},error:function(r,a){return e._handleFormAjaxFailure(t,a)}})},Emory.prototype._submitFormAjaxFileFallback=function(t){var e=this,r=e._attributePrefix+"TARGET-"+Date.now();$formTarget=$('<iframe name="'+r+'" style="width: 1px; height: 1px; position: absolute; left: -100000px; top: 1px;"></iframe>'),$("body").append($formTarget),t.attr("target",r),$formTarget.load(function(){var r="{}";if($formTarget.contents().find("body").length)r=$formTarget.contents().find("body").get(0).innerHTML;else{var a=$formTarget.get(0).contentDocument,i=new XMLSerializer;r=i.serializeToString(a)}$formTarget.remove(),t.removeAttr("target"),e._handleFormAjaxComplete(t,JSON.parse(r))}),t.submit()},Emory.prototype._handleFormAjaxFailure=function(t,e){var r=this;return t.attr(r._attributePrefix+"loading-target")&&$(t.attr(r._attributePrefix+"loading-target")).removeClass(r._attributePrefix+"loading"),r._addAlert(t,e,"error")},Emory.prototype._handleFormAjaxComplete=function(t,e){var r=this,a=r._getResponseCallbackUrl(e);if(a.length>0)return void(e.callback_url==window.location.href?window.location.reload(!0):window.location.href=e.callback_url);if(t.attr(r._attributePrefix+"loading-target")&&$(t.attr(r._attributePrefix+"loading-target")).removeClass(r._attributePrefix+"loading"),!r._checkResponseSuccess(e)){var i=r._getResponseErrorString(e);return i.length||(i="An unknown error has occurred."),r._addAlert(t,i,"error")}var o=$();return r._ajaxCompletePreviewHide(t,e,o)},Emory.prototype._ajaxCompletePreviewHide=function(t,e,r){var a=this;return"undefined"==typeof t.attr(a._attributePrefix+"ajax-preview-hide-target")?a._ajaxCompletePreviewShow(t,e,r):a._hideTarget(t,$(t.attr(a._attributePrefix+"ajax-preview-hide-target")),function(){a._ajaxCompletePreviewShow(t,e,r)})},Emory.prototype._ajaxCompletePreviewShow=function(t,e,r){var a=this;return"undefined"==typeof t.attr(a._attributePrefix+"ajax-preview-show-target")?a._ajaxCompleteViewReplace(t,e,r):a._showTarget(t,$(t.attr(a._attributePrefix+"ajax-preview-show-target")),function(){a._ajaxCompleteViewReplace(t,e,r)})},Emory.prototype._ajaxCompleteViewReplace=function(t,e,r){var a=this;return $.each(t.get(0).attributes,function(t,i){var o=i.name,n=i.value;if(a.__matchPattern(o,"ajax-view-","-replace-target")){var s=a.__getKey(o,"ajax-view-","-replace-target");if(s.length>0){var u=a._getResponseViewHtml(e,s);u.length>0&&($targets=$(n),$targets.each(function(t,e){var i=$(u);i.css("display","none"),$(e).after(i),$(e).remove(),i.trigger(a._attributePrefix+"view-loaded"),r=r.add(i)}))}}}),a._ajaxCompleteViewPrepend(t,e,r)},Emory.prototype._ajaxCompleteViewPrepend=function(t,e,r){var a=this;return $.each(t.get(0).attributes,function(t,i){var o=i.name,n=i.value;if(a.__matchPattern(o,"ajax-view-","-prepend-target")){var s=a.__getKey(o,"ajax-view-","-prepend-target");if(s.length>0){var u=a._getResponseViewHtml(e,s);u.length>0&&($targets=$(n),$targets.each(function(t,e){var i=$(u);i.css("display","none"),$(e).prepend(i),i.trigger(a._attributePrefix+"view-loaded"),r=r.add(i)}))}}}),a._ajaxCompleteViewAppend(t,e,r)},Emory.prototype._ajaxCompleteViewAppend=function(t,e,r){var a=this;return $.each(t.get(0).attributes,function(t,i){var o=i.name,n=i.value;if(a.__matchPattern(o,"ajax-view-","-append-target")){var s=a.__getKey(o,"ajax-view-","-append-target");if(s.length>0){var u=a._getResponseViewHtml(e,s);u.length>0&&($targets=$(n),$targets.each(function(t,e){var i=$(u);i.css("display","none"),$(e).append(i),i.trigger(a._attributePrefix+"view-loaded"),r=r.add(i)}))}}}),a._ajaxCompletePostviewHide(t,e,r)},Emory.prototype._ajaxCompletePostviewHide=function(t,e,r){var a=this;return"undefined"==typeof t.attr(a._attributePrefix+"ajax-postview-hide-target")?a._ajaxCompletePostviewShow(t,e,r):a._hideTarget(t,$(t.attr(a._attributePrefix+"ajax-postview-hide-target")),function(){a._ajaxCompletePostviewShow(t,e,r)})},Emory.prototype._ajaxCompletePostviewShow=function(t,e,r){var a=this;return"undefined"==typeof t.attr(a._attributePrefix+"ajax-postview-show-target")?a._ajaxCompleteShowTargets(t,e,r):a._showTarget(t,$(t.attr(a._attributePrefix+"ajax-postview-show-target")),function(){a._ajaxCompleteShowTargets(t,e,r)})},Emory.prototype._ajaxCompleteShowTargets=function(t,e,r){var a=this;return"undefined"!=typeof t.attr(a._attributePrefix+"ajax-view-noautoshow")?a._ajaxCompleteShowMessage(t,e):($hiddenShowTargets=r.filter(":hidden"),0===$hiddenShowTargets.length?a._ajaxCompleteShowMessage(t,e):a._showTarget(t,$hiddenShowTargets,function(){a._ajaxCompleteShowMessage(t,e)}))},Emory.prototype._ajaxCompleteShowMessage=function(t,e){var r=this,a=r._getResponseMessageString(e);return 0===a.length?r._ajaxCompleteCallback(t,e):r._addAlert(t,a,"success",function(){r._ajaxCompleteCallback(t,e)})},Emory.prototype._ajaxCompleteCallback=function(t,e){var r=this;if("undefined"!=typeof t.attr(r._attributePrefix+"ajax-callback"))return window[t.attr(r._attributePrefix+"ajax-callback")](e,t)},Emory.prototype._showTarget=function(t,e,r){var a=this;"function"!=typeof r&&(r=function(){});var i="slide";return"undefined"!=typeof t.attr(a._attributePrefix+"ajax-transition")&&(i=t.attr(a._attributePrefix+"ajax-transition")),(!i||Array("slide","fade").indexOf(i)<0)&&(i="slide"),"slide"==i?e.slideDown(function(){e.trigger(a._attributePrefix+"view-shown")}).promise().done(r):"fade"==i?e.fadeIn(function(){e.trigger(a._attributePrefix+"view-shown")}).promise().done(r):void 0},Emory.prototype._hideTarget=function(t,e,r){var a=this;"function"!=typeof r&&(r=function(){});var i="slide";return"undefined"!=typeof t.attr(a._attributePrefix+"ajax-transition")&&(i=t.attr(a._attributePrefix+"ajax-transition")),(!i||Array("slide","fade").indexOf(i)<0)&&(i="slide"),"slide"==i?e.slideUp(function(){e.trigger(a._attributePrefix+"view-hidden")}).promise().done(r):"fade"==i?e.fadeOut(function(){e.trigger(a._attributePrefix+"view-hidden")}).promise().done(r):void 0},Emory.prototype._removeAllAlerts=function(t,e){var r=this;$alerts=e.children("["+r._attributePrefix+"alert]"),r._hideTarget(t,$alerts,function(){$alerts.remove()})},Emory.prototype._addAlert=function(t,e,r,a){var i=this;return"function"!=typeof a&&(a=function(){}),"undefined"!=typeof t.attr(i._attributePrefix+"alert-target")?($target=$(t.attr(i._attributePrefix+"alert-target")),$alert=$(i._generateAlertHtml(e,r)),$alert.css("display","none"),$target.prepend($alert),i._showTarget(t,$alert,a)):void 0};